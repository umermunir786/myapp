#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🚀 Running pre-push checks..."

# Check if we're on main/master branch
current_branch=$(git rev-parse --abbrev-ref HEAD)
if [ "$current_branch" = "main" ] || [ "$current_branch" = "master" ]; then
  echo "⚠️  Pushing to $current_branch branch - running full validation..."
  
  # Run full linting
  echo "🔍 Running ESLint..."
  npm run lint:check
  
  # Run full formatting check
  echo "🎨 Checking code formatting..."
  npm run format:check
  
  # Run TypeScript compilation
  echo "📝 Checking TypeScript compilation..."
  npx tsc --noEmit
  
  # Run all tests
  if npm run test --silent 2>/dev/null; then
    echo "🧪 Running all tests..."
    npm run test -- --passWithNoTests --watchAll=false
  fi
  
  echo "✅ All pre-push checks passed for $current_branch!"
else
  echo "📝 Feature branch push - running basic checks..."
  
  # Run TypeScript check only
  npx tsc --noEmit
  
  echo "✅ Basic checks passed!"
fi
