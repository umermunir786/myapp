#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Check if we're on main/master branch
current_branch=$(git rev-parse --abbrev-ref HEAD)
if [ "$current_branch" = "main" ] || [ "$current_branch" = "master" ]; then
  echo "âš ï¸  Pushing to $current_branch branch - running full validation..."
  
  # Run full linting
  echo "ğŸ” Running ESLint..."
  npm run lint:check
  
  # Run full formatting check
  echo "ğŸ¨ Checking code formatting..."
  npm run format:check
  
  # Run TypeScript compilation
  echo "ğŸ“ Checking TypeScript compilation..."
  npx tsc --noEmit
  
  # Run all tests
  if npm run test --silent 2>/dev/null; then
    echo "ğŸ§ª Running all tests..."
    npm run test -- --passWithNoTests --watchAll=false
  fi
  
  echo "âœ… All pre-push checks passed for $current_branch!"
else
  echo "ğŸ“ Feature branch push - running basic checks..."
  
  # Run TypeScript check only
  npx tsc --noEmit
  
  echo "âœ… Basic checks passed!"
fi
